{"version":3,"sources":["../src/KpiAgile.Migracao.js"],"names":[],"mappings":"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","file":"KpiAgile.Migracao.js","sourcesContent":["var intLeadTime = new Array();\r\nvar nWIP = new Array();\r\nvar nTotalPaginas = new Array();\r\nvar countWorkItems = 0;\r\nvar settings = null;\r\nvar dtStartThroughput = new Date();\r\nvar dtEndThroughput = new Date(1969);\r\nvar client = null;\r\nvar fieldName = \"System.BoardColumn\";\r\nvar strStartStage = \"1.Cópia e Ajustes\";\r\nvar strLastStage = \"5.Disponibilizado Para Homologação UAT\";\r\n\r\nVSS.init({\r\n    explicitNotifyLoaded: true,\r\n    usePlatformStyles: true\r\n});\r\n\r\nVSS.require([\"TFS/Dashboards/WidgetHelpers\", \"TFS/WorkItemTracking/RestClient\"],\r\n    function(WidgetHelpers, TFS_Wit_WebApi) {\r\n        WidgetHelpers.IncludeWidgetStyles();\r\n        VSS.register(\"LeadTimeMetric\", function() {\r\n            var getLeadTime = function(widgetSettings) {\r\n\r\n                // Get a WIT client to make REST calls to VSTS\r\n                client = TFS_Wit_WebApi.getClient();\r\n                var projectId = VSS.getWebContext().project.id;\r\n                settings = JSON.parse(widgetSettings.customSettings.data);\r\n                if (!settings || !settings.queryPath) {\r\n                    $('#query-info-container').empty().text(\"0\");\r\n                    $('#footer').empty().text(\"Please configure a query path\");\r\n                    return WidgetHelpers.WidgetStatusHelper.Success();\r\n                }\r\n                if (WidgetHelpers.WidgetEvent.ConfigurationChange) {\r\n                    $('#error').empty();\r\n                    $('h2.title').text(\"\");\r\n                    $('#query-info-container').empty().text(\"\");\r\n                    $('#widget').css('background-color', 'rgb(0, 0, 0)');\r\n                    $(\"<img></img>\").attr(\"src\", \"img/loadingAnimation.gif\").appendTo($('#query-info-container'));\r\n                    $('#footer').empty().text(\"\");\r\n\r\n                    //Get a tfs query to get it's id\r\n                    return client.getQuery(projectId, settings.queryPath).then(query => {\r\n                            //Get query result\r\n                            client.queryById(query.id).then(ResultQuery,\r\n                                function(error) {\r\n                                    $('#error').text(\"There is an error in query \" + settings.queryPath.substr(15) + \": \" + error.message);\r\n                                    return WidgetHelpers.WidgetStatusHelper.Failure(error.message);\r\n                                });\r\n                            return WidgetHelpers.WidgetStatusHelper.Success();\r\n                        },\r\n                        function(error) {\r\n                            return WidgetHelpers.WidgetStatusHelper.Failure(error.message);\r\n                        }\r\n                    );\r\n                }\r\n            };\r\n\r\n            return {\r\n                load: function(widgetSettings) {\r\n                    return getLeadTime(widgetSettings);\r\n                },\r\n                reload: function(widgetSettings) {\r\n                    return getLeadTime(widgetSettings);\r\n                }\r\n            };\r\n        });\r\n        VSS.notifyLoadSucceeded();\r\n    }\r\n);\r\n\r\nfunction ResultQuery(resultQuery) {\r\n\r\n    //ForEach workItem in query, get the respective Revision\r\n    intLeadTime = new Array();\r\n    if (resultQuery.queryType == 1) { //flat query\r\n        countWorkItems = resultQuery.workItems.length;\r\n        if (countWorkItems > 0) {\r\n            resultQuery.workItems.forEach(workItem => {\r\n                //Validations\r\n                if (workItem.fields[\"System.State\"] == \"New\") {\r\n                    return;\r\n                }\r\n                client.getRevisions(workItem.id).then(ProcessRevisions);\r\n            });\r\n        }\r\n    } else {\r\n        countWorkItems = resultQuery.workItemRelations.length;\r\n        if (countWorkItems > 0) {\r\n            resultQuery.workItemRelations.forEach(workItem => {\r\n                client.getRevisions(workItem.target.id).then(ProcessRevisions);\r\n            });\r\n        }\r\n    }\r\n    if (countWorkItems == 0) {\r\n        $('#error').empty();\r\n        $('h2.title').text(settings.queryPath.substr(15));\r\n        $('#query-info-container').empty().text(\"-\");\r\n        $('#footer').empty().text(\"This query does not return any work items\");\r\n        return WidgetHelpers.WidgetStatusHelper.Success();\r\n    }\r\n}\r\n\r\nfunction ProcessRevisions(revisions) {\r\n\r\n    //Count WIP\r\n    if (revisions[revisions.length].fields[fieldName] != strLastStage && revisions.some(s => s.Key == \"Microsoft.VSTS.Scheduling.OriginalEstimate\")) {\r\n        nWIP.push(revisions[revisions.length].fields[\"Microsoft.VSTS.Scheduling.OriginalEstimate\"]);\r\n    }\r\n\r\n    //Validations\r\n    if (revisions.some(s => s.Fields[fieldName] != strStartStage || s.Fields[fieldName] != strStartStage.Remove(0, 2))) //Valida se o PBI passou pelo stage Inicial\r\n        return;\r\n    if (revisions.some(s => s.Fields[fieldName] != strLastStage || s.Fields[fieldName] != strLastStage.Remove(0, 2))) //Valida se o PBI chegou no stage Final\r\n        return;\r\n    if (revisions[revisions.length].fields[fieldName] == strStartStage || revisions[revisions.length].fields[fieldName] == strStartStage.Remove(0, 2)) //Valida se o PBI voltou ao stage inicial\r\n        return;\r\n    //Validations^^^^^^^^\r\n\r\n    var RevApproved = revisions.find(workItemRevision => {\r\n        return workItemRevision.fields[fieldName] == strStartStage || workItemRevision.fields[fieldName] == strStartStage.Remove(0, 2);\r\n    });\r\n\r\n    var RevDone = revisions.find(workItemRevision => {\r\n        return workItemRevision.fields[fieldName] == strLastStage || workItemRevision.fields[fieldName] == strLastStage.Remove(0, 2);\r\n    });\r\n\r\n    var dateApproved = (RevApproved != null && RevApproved.fields != undefined) ? new Date(RevApproved.fields[\"System.ChangedDate\"]) : new Date();\r\n    var dateDone = (RevDone != null && RevDone.fields != undefined) ? new Date(RevDone.fields[\"System.ChangedDate\"]) : new Date();\r\n\r\n    //Throughput - Range date\r\n    if (dtStartThroughput > dateApproved) {\r\n        dtStartThroughput = dateApproved;\r\n    }\r\n    if (dtEndThroughput < dateDone) {\r\n        dtEndThroughput = dateDone;\r\n    }\r\n\r\n    intLeadTime.push(1);\r\n    nTotalPaginas.push(revisions[revisions.length].fields[\"Microsoft.VSTS.Scheduling.OriginalEstimate\"]);\r\n\r\n    ShowResult();\r\n}\r\n\r\nfunction ShowResult() {\r\n    if (countWorkItems == intLeadTime.length) {\r\n        var tsIntervaloTotal = DaysBetween(dtStartThroughput, dtEndThroughput)\r\n\r\n        $('#error').empty();\r\n        $('h2.title').text(settings.queryPath.substr(15));\r\n        $('#widget').css({ 'color': 'white', 'background-color': 'rgb(0, 156, 204)' });\r\n\r\n        var sumWIP = 0;\r\n        nWIP.forEach(item => {\r\n            sumWIP += item;\r\n        });\r\n        var sumPag = 0;\r\n        nTotalPaginas.forEach(item => {\r\n            sumPag += item;\r\n        });\r\n        var throughput = (sumPag / tsIntervaloTotal);\r\n        if (settings.metric == \"throughput\") {\r\n            $('#query-info-container').empty().html(Math.round(throughput * 10) / 10);\r\n            $('#footer').empty().text(\"(Throughput) Items by Day\");\r\n        } else if (settings.metric == \"leadtime\") {\r\n            var leadTime = (sumWIP / throughput); //---\"WIP * CycleTime\" ou \"WIP / Throughput\r\n            $('#query-info-container').empty().html(Math.round(leadTime * 10) / 10);\r\n            $('#footer').empty().text(\"(Lead Time) Estimate in Days\");\r\n        }\r\n\r\n    }\r\n}\r\n\r\nfunction DaysBetween(date1, date2) {\r\n    //Get 1 day in milliseconds\r\n    var one_day = 1000 * 60 * 60 * 24;\r\n\r\n    // Convert both dates to milliseconds\r\n    var date1_ms = date1.getTime();\r\n    var date2_ms = date2.getTime(); //\r\n\r\n    // Calculate the difference in milliseconds\r\n    var difference_ms = date2_ms - date1_ms;\r\n\r\n    // Convert back to days and return\r\n    return Math.round(difference_ms / one_day);\r\n}"]}