{"version":3,"sources":["../src/KpiAgile.js"],"names":[],"mappings":"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","file":"KpiAgile.js","sourcesContent":["var intLeadTime = new Array();\r\nvar countWorkItems = 0;\r\nVSS.init({\r\n    explicitNotifyLoaded: true,\r\n    usePlatformStyles: true\r\n});\r\n\r\nVSS.require([\"TFS/Dashboards/WidgetHelpers\", \"TFS/WorkItemTracking/RestClient\"],\r\n    function(WidgetHelpers, TFS_Wit_WebApi) {\r\n        WidgetHelpers.IncludeWidgetStyles();\r\n        VSS.register(\"LeadTimeMetric\", function() {\r\n            var getLeadTime = function(widgetSettings) {\r\n\r\n                // Get a WIT client to make REST calls to VSTS\r\n                var client = TFS_Wit_WebApi.getClient();\r\n                var projectId = VSS.getWebContext().project.id;\r\n                var settings = JSON.parse(widgetSettings.customSettings.data);\r\n                if (!settings || !settings.queryPath) {\r\n                    $('#query-info-container').empty().text(\"0\");\r\n                    $('#footer').empty().text(\"Please configure a query path.\");\r\n                    return WidgetHelpers.WidgetStatusHelper.Success();\r\n                }\r\n\r\n                //Get a tfs query to get it's id\r\n                return client.getQuery(projectId, settings.queryPath).then(query => {\r\n                        //Get query result\r\n                        client.queryById(query.id).then(resultQuery => {\r\n                            //ForEach workItem in query, get the respective Revision\r\n                            countWorkItems = resultQuery.workItems.length;\r\n                            resultQuery.workItems.forEach(workItem => {\r\n                                client.getRevisions(workItem.id).then(ProcessRevisions);\r\n                            });\r\n                        });\r\n                        return WidgetHelpers.WidgetStatusHelper.Success();\r\n                    },\r\n                    function(error) {\r\n                        return WidgetHelpers.WidgetStatusHelper.Failure(error.message);\r\n                    }\r\n                );\r\n            };\r\n\r\n            return {\r\n                load: function(widgetSettings) {\r\n                    // var $title = $('h2.title');\r\n                    // $title.text('Lead Time');\r\n                    return getLeadTime(widgetSettings);\r\n                },\r\n                reload: function(widgetSettings) {\r\n                    return getLeadTime(widgetSettings);\r\n                }\r\n            };\r\n        });\r\n        VSS.notifyLoadSucceeded();\r\n    }\r\n);\r\n\r\nfunction ProcessRevisions(workItem) {\r\n\r\n    var RevApproved = workItem.find(workItemRevision => {\r\n        return workItemRevision.fields[\"System.State\"] == \"Approved\";\r\n    });\r\n\r\n    var RevDone = workItem.find(workItemRevision => {\r\n        return workItemRevision.fields[\"System.State\"] == \"Done\";\r\n    });\r\n\r\n    var dateApproved = (RevApproved != null && RevApproved.fields != undefined) ? new Date(RevApproved.fields[\"System.ChangedDate\"]) : new Date();\r\n    var dateDone = (RevDone != null && RevDone.fields != undefined) ? new Date(RevDone.fields[\"System.ChangedDate\"]) : new Date();\r\n\r\n    intLeadTime.push(DaysBetween(dateApproved, dateDone));\r\n\r\n    ShowResult();\r\n}\r\n\r\nfunction DaysBetween(date1, date2) {\r\n    //Get 1 day in milliseconds\r\n    var one_day = 1000 * 60 * 60 * 24;\r\n\r\n    // Convert both dates to milliseconds\r\n    var date1_ms = date1.getTime();\r\n    var date2_ms = date2.getTime();\r\n\r\n    // Calculate the difference in milliseconds\r\n    var difference_ms = date2_ms - date1_ms;\r\n\r\n    // Convert back to days and return\r\n    return Math.round(difference_ms / one_day);\r\n}\r\n\r\nfunction ShowResult() {\r\n    var sum = 0;\r\n    intLeadTime.forEach(item => {\r\n        sum += item;\r\n    });\r\n    var avg = (sum / intLeadTime.length);\r\n\r\n    if (countWorkItems == intLeadTime.length) {\r\n        $('#query-info-container').empty().html(Math.round(avg * 10) / 10);\r\n    }\r\n}"]}